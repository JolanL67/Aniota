{% extends 'base.html.twig' %}

{% block title %}Anime list - {{ parent() }}{% endblock %}
{% block stylesheet %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/anime-style.css') }}">
{% endblock %}

{% block body %}

<h1 class="titleAnimes">List of Animes</h1>
<div class="dropdowns">

  <div class="dropdown genre">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Select Anime By Genre
    </button>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      {% for anime in animeGenre %}
          <a class="dropdown-item" href="{{ path('anime', {'genre': anime.id} )}}">{{ anime.name }}</a>
      {% endfor %}
    </div>
  </div>

  <div class="dropdown rating">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Select Anime By Rating
    </button>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      {% for anime in animeRating %}
          <a class="dropdown-item" href="{{ path('anime', {'rated': anime.id} )}}">{{ anime.name }}</a>
      {% endfor %}
      {# This rating are base on MyAnimeList Rating https://myanimelist.net/info.php?go=mpaa #}
    </div>
  </div>
</div>

{% if animes is not empty %}
  <div class="pagination {{ page > 1 ? '' : 'pagination2' }}">
      {% if page > "1" %}
          <a href="{{ path('anime', {'page': page - 1, 'rated': rated, 'genre': genre} )}}" class="btn btn-info previous">Previous Page</a>
      {% endif %}
          <a href="{{ path('anime', {'page': page + 1, 'rated': rated, 'genre': genre} )}}" class="btn btn-info next">Next Page</a>
  </div>
{% endif %}

<div class="wrapper {{ animes is empty ? 'wrapper2' : '' }}">
    
    {% for anime in animes %}

        <div class="card" style="width: 18rem;">
            <img src="{{ anime.image_url}}" class="card-img-top" alt="...">
            <div class="card-body">
                
                {% if app.user %}
                  
                  {% set break = false %}
                  
                  {% for anime1 in app.user.favorites %}
                    {% if anime1.malId == anime.mal_id %}
                      <a href="{{ path('favorite_anime', {'id': anime.mal_id} )}}">
                        <i class="fa fa-heart" aria-hidden="true"></i>
                        {% set break = true %}
                      </a>
                    {% endif %}
                  {% endfor %}
                  
                  {% if not break %}
                    <a href="{{ path('favorite_anime', {'id': anime.mal_id} )}}">
                      <i class="fa fa-heart-o" aria-hidden="true"></i>
                    </a>
                  {% endif %}
                  
                {% endif %}
                
                <h5 class="card-title">{{ anime.title}}</h5>
                
                {% if anime.synopsis == null %}
                    <p>There is no description for this anime</p>
                {% else %}
                    <p class="card-text">{{ anime.synopsis}}</p>
                {% endif %}
                
                <a href="{{ path('anime_details', { 'id': anime.mal_id} )}}" class="btn btn-primary">Details</a>
            </div>
        </div>

    {% endfor %}
</div>
    
    {% if animes is empty %}
      <div class="empty-anime">
        <p class="sorryMsg">Sorry there are no more animes for this category.</p> 
        <a href="{{path('anime')}}" class="btn btn-info linkEmpty">Back to animes list</a>
      </div>
    {% else %}
        <div class="pagination {{ page > 1 ? '' : 'pagination2' }}">
        {% if page > "1" %}
            <a href="{{ path('anime', {'page': page - 1, 'rated': rated, 'genre': genre} )}}" class="btn btn-info previous">Previous Page</a>
        {% endif %}
            <a href="{{ path('anime', {'page': page + 1, 'rated': rated, 'genre': genre} )}}" class="btn btn-info next">Next Page</a>
        </div>
    {% endif %}




{% endblock %}
